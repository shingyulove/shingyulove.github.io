<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥³åƒ•æ‰‹ç¹ª Chekki (æœ€çµ‚å®Œæ•´ç‰ˆ)</title>
    <style>
        /* 1. å¼•å…¥å­—é«” */
        @import url('https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=RocknRoll+One&family=Yomogi&display=swap');

        :root {
            --bg-color: #fff5f7;
            --card-bg: #ffffff;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            /* èƒŒæ™¯ç¶²æ ¼ */
            background-image: 
                linear-gradient(#ffdce5 1px, transparent 1px),
                linear-gradient(90deg, #ffdce5 1px, transparent 1px);
            background-size: 20px 20px;
            
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100dvh;
            margin: 0;
            padding-top: 20px;
            padding-bottom: 40px;
            overflow-y: auto;
            overflow-x: hidden;
            user-select: none;
            font-family: 'Yomogi', cursive;
            -webkit-tap-highlight-color: transparent;
        }

        h1 {
            color: #ff8da1;
            font-family: 'RocknRoll One', sans-serif;
            margin: 0 0 15px 0;
            font-size: 1.4rem;
            letter-spacing: 2px;
            z-index: 10;
            text-shadow: 2px 2px 0 #fff;
        }

        /* æŒ‰éˆ•å€ */
        .controls { margin-top: 20px; z-index: 100; padding-bottom: 20px; }

        button {
            background: #ff8da1;
            color: white;
            border: 3px solid #fff;
            padding: 12px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            font-family: 'RocknRoll One', sans-serif;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 141, 161, 0.4);
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.95); }

        /* æ‹ç«‹å¾—å¡ç‰‡ */
        .instax {
            position: relative;
            width: 340px;
            height: 540px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.08);
            overflow: hidden;
            transform-origin: top center;
            flex-shrink: 0;
        }

        /* æ‰‹æ©Ÿé©é… */
        @media (max-width: 380px) {
            .instax { transform: scale(0.85); margin-bottom: -60px; }
        }

        /* ç…§ç‰‡å€åŸŸ (ç°è‰²) */
        .photo-area {
            position: absolute;
            top: 30px; left: 20px;
            width: 300px; height: 380px;
            background-color: #e0e0e0;
            background-image: radial-gradient(#d0d0d0 10%, transparent 10%);
            background-size: 15px 15px;
            z-index: 1;
            border-radius: 2px;
        }

        /* ç•«å¸ƒå±¤ */
        .canvas-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none;
        }

        /* ç°½åæ¨£å¼ */
        .signature-group {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 50;
        }
        .sig-name {
            font-family: 'RocknRoll One', sans-serif;
            font-size: 2.5rem; color: #ff6b8b; line-height: 1;
            text-shadow: 2px 2px 0 #fff;
        }
        .sig-date {
            font-family: 'Dela Gothic One', cursive;
            font-size: 1.1rem; color: #888; margin-top: 5px;
            text-shadow: 1px 1px 0 #fff;
        }

        /* åœ–æ¡ˆå®¹å™¨ */
        .doodle-item {
            position: absolute;
            display: flex; justify-content: center; align-items: center;
            z-index: 20;
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* é—œéµï¼šè®“ PNG è‡ªå‹•è®Šè‰²çš„æ¨£å¼ */
        .colored-icon {
            width: 100%;
            height: 100%;
            /* èƒŒæ™¯è‰²ç”± JS å‹•æ…‹è¨­å®šï¼Œé€™è£¡åªè¨­ mask */
            -webkit-mask-size: contain;
            mask-size: contain;
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-position: center;
            mask-position: center;
            opacity: 0.9; /* åƒå°ç« ä¸€æ¨£ç¨å¾®é€ä¸€é» */
        }

        /* SVG æ¨£å¼ */
        .doodle-svg { opacity: 0.95; }

        /* æ—¥æ–‡æ–‡å­— */
        .text-item {
            position: absolute; z-index: 25;
            font-weight: bold; white-space: nowrap;
            mix-blend-mode: multiply; line-height: 1;
        }

        @keyframes pop {
            from { transform: scale(0) rotate(0deg); opacity: 0; }
            to { opacity: 1; } 
        }
    </style>
</head>
<body>

    <h1>ğŸ¨ å¥³åƒ•æ‰‹ç¹ª Chekki</h1>

    <div class="instax">
        <div class="photo-area"></div>
        <div class="canvas-layer" id="canvas"></div>
    </div>

    <div class="controls">
        <button onclick="generateArt()">âœ¨ ç”Ÿæˆéš¨æ©Ÿåœ–æ¡ˆ âœ¨</button>
    </div>

    <script>
        // =======================================================
        // 1. ç”¨æˆ¶è¨­ç½®å€ (è«‹ä¿®æ”¹é€™è£¡)
        // =======================================================
        
        /* 
           è«‹å°‡ä½ çš„ç´”é»‘ PNG æ”¾å…¥ images æ–‡ä»¶å¤¾ã€‚
           ç„¶å¾Œåœ¨é€™è£¡å¡«å¯«æ–‡ä»¶åã€‚
           ä¾‹å¦‚: "./images/star.png"
        */
        const pngLibrary = [
            // é€™è£¡æˆ‘æ”¾å¹¾å€‹ç¶²è·¯ä¸Šçš„é»‘è‰²åœ–æ¨™ä½œç‚ºæ¼”ç¤ºï¼Œä½ å¯ä»¥åˆªæ‰æ›æˆä½ çš„æœ¬åœ°è·¯å¾‘
            "https://cdn-icons-png.flaticon.com/128/1828/1828884.png", // æ˜Ÿæ˜Ÿ
            "https://cdn-icons-png.flaticon.com/128/1077/1077035.png", // æ„›å¿ƒ
            "https://cdn-icons-png.flaticon.com/128/2913/2913520.png", // æ«»æ¡ƒ
            "./images/Favorite.png",   // è´è¶çµ
            // ä½ å¯¦éš›ä½¿ç”¨æ™‚æ‡‰è©²é•·é€™æ¨£ï¼š
            // "./images/1.png",
            // "./images/2.png",
        ];

        // å’Œè«§é…è‰²ç›¤ (è«è˜­è¿ª/é¦¬å¡é¾)
        const palette = ["#FF9AA2", "#FFB7B2", "#FFDAC1", "#E2F0CB", "#B5EAD7", "#C7CEEA", "#90BAD6", "#F0A6CA"];
        
        // ç°½åç­†è‰² (æ·±ä¸€é»)
        const penColors = ["#ff6b8b", "#ff9f43", "#5f27cd", "#54a0ff", "#1dd1a1"];
        
        // å¥³åƒ•åå­—
        const maidNames = ["Miku", "Rina", "Hana", "Momo", "Yuki", "Alice", "Coco"];
        
        // æ—¥æ–‡çŸ­èª
        const jpTexts = ["å¤§å¥½ã", "æ¨ã—â™¡", "ã«ã‚ƒã‚“", "LOVE", "ç¥å¯¾å¿œ", "èŒãˆ", "Chu!", "å°Šã„"];

        // =======================================================
        // 2. å…§å»ºè³‡æº (æ‰‹ç¹ª SVG)
        // =======================================================
        const doodles = [
            { type: 'stroke', path: 'M50,10 Q60,40 90,50 Q60,60 50,90 Q40,60 10,50 Q40,40 50,10' }, // é–ƒå…‰
            { type: 'stroke', path: 'M20,20 L40,40 M40,20 L20,40 M60,20 L80,40 M80,20 L60,40' }, // XX
            { type: 'stroke', path: 'M50,20 C20,20 10,50 30,70 L50,90 L70,70 C90,50 80,20 50,20 Z' }, // æ„›å¿ƒ
            { type: 'stroke', path: 'M10,50 Q30,20 50,50 T90,50' }, // æ³¢æµª
            { type: 'stroke', path: 'M50,50 m-20,0 a20,20 0 1,1 40,0 a20,20 0 1,1 -40,0' }, // åœˆåœˆ
            { type: 'stroke', path: 'M50,10 C20,40 20,80 50,90 C80,80 80,40 50,10 Z' }, // æ°´æ»´
            { type: 'fill', path: 'M50,90 C20,60 0,40 20,20 C35,5 50,25 50,25 C50,25 65,5 80,20 C100,40 80,60 50,90 Z' },
            { type: 'fill', path: 'M50,5 L60,35 L95,35 L70,55 L80,90 L50,70 L20,90 L30,55 L5,35 L40,35 Z' }
        ];

        let occupiedRects = [];

        // =======================================================
        // 3. æ ¸å¿ƒé‚è¼¯
        // =======================================================

        function generateArt() {
            const canvas = document.getElementById('canvas');
            canvas.innerHTML = '';
            occupiedRects = [];

            // 1. ç•«é‚Šæ¡†
            drawCreativeBorder(canvas);

            // 2. ç•«ç°½å
            drawSignature(canvas);

            // 3. ç•«æ—¥æ–‡ (1-2å€‹)
            const textCount = 1 + Math.floor(Math.random() * 2);
            for(let i=0; i<textCount; i++) drawText(canvas);

            // 4. ç•«åœ–æ¡ˆ (6-9å€‹ï¼ŒPNGèˆ‡SVGæ··æ­)
            const doodleCount = 6 + Math.floor(Math.random() * 4);
            for(let i=0; i<doodleCount; i++) drawRandomAsset(canvas);
        }

        function drawRandomAsset(container) {
            // å¦‚æœ PNG åº«æœ‰æ±è¥¿ï¼Œ60% æ©Ÿç‡ç”¨ PNG
            const usePng = (pngLibrary.length > 0) && (Math.random() < 0.6);

            if (usePng) {
                drawPngSticker(container);
            } else {
                drawSvgDoodle(container);
            }
        }

        // === é—œéµå‡½æ•¸ï¼šPNG è‡ªå‹•è®Šè‰² ===
        function drawPngSticker(container) {
            const src = pngLibrary[Math.floor(Math.random() * pngLibrary.length)];
            const color = palette[Math.floor(Math.random() * palette.length)]; // éš¨æ©Ÿé¸è‰²
            
            const el = document.createElement('div');
            el.className = 'doodle-item';
            
            // ä½¿ç”¨ div + mask ä¾†å¯¦ç¾è®Šè‰²
            const icon = document.createElement('div');
            icon.className = 'colored-icon';
            icon.style.backgroundColor = color; // é€™è£¡è¨­å®šé¡è‰²
            icon.style.webkitMaskImage = `url('${src}')`;
            icon.style.maskImage = `url('${src}')`;
            
            el.appendChild(icon);

            const size = 45 + Math.random() * 45; 
            el.style.width = `${size}px`;
            el.style.height = `${size}px`;

            const rot = (Math.random() - 0.5) * 40;
            const scale = 0.9 + Math.random() * 0.2;
            el.style.transform = `rotate(${rot}deg) scale(${scale})`;

            container.appendChild(el);
            placeItem(el, size, size, container);
        }

        function drawSvgDoodle(container) {
            const data = doodles[Math.floor(Math.random() * doodles.length)];
            const color = palette[Math.floor(Math.random() * palette.length)];
            const size = 50 + Math.random() * 50; 
            
            const el = document.createElement('div');
            el.className = 'doodle-item doodle-svg';
            el.style.width = `${size}px`;
            el.style.height = `${size}px`;

            const strokeWidth = 2 + Math.random() * 3;
            let svgContent = '';

            if (data.type === 'stroke') {
                svgContent = `<path d="${data.path}" stroke="${color}" stroke-width="${strokeWidth}" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`;
            } else {
                svgContent = `<path d="${data.path}" fill="${color}" stroke="none" opacity="0.8"/>`;
            }

            el.innerHTML = `<svg viewBox="0 0 100 100" style="overflow:visible; width:100%; height:100%">${svgContent}</svg>`;

            const rot = (Math.random() - 0.5) * 90; 
            const scale = 0.7 + Math.random() * 0.6; 
            el.style.transform = `rotate(${rot}deg) scale(${scale})`;

            container.appendChild(el);
            placeItem(el, size, size, container);
        }

        // === é‚Šæ¡†ç”Ÿæˆ ===
        function drawCreativeBorder(container) {
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            Object.assign(svg.style, {
                position: 'absolute', top: 0, left: 0, width: '100%', height: '100%',
                zIndex: 5, pointerEvents: 'none'
            });

            const color = palette[Math.floor(Math.random() * palette.length)];
            const type = Math.floor(Math.random() * 4); 
            const x=20, y=30, w=300, h=380; 

            if (type === 0) drawPath(svg, generateWobblyRect(x, y, w, h), color, 3);
            else if (type === 1) drawDecoratedRect(svg, x, y, w, h, color, 'circle');
            else if (type === 2) drawDecoratedRect(svg, x, y, w, h, color, 'cross');
            else {
                const color2 = palette[Math.floor(Math.random() * palette.length)];
                drawPath(svg, generateWobblyRect(x, y, w, h), color, 2);
                drawPath(svg, generateWobblyRect(x+5, y+5, w, h), color2, 2);
            }
            container.appendChild(svg);
        }

        function drawPath(svg, d, color, width) {
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", d);
            path.setAttribute("fill", "none");
            path.setAttribute("stroke", color);
            path.setAttribute("stroke-width", width);
            path.setAttribute("stroke-linecap", "round");
            path.setAttribute("opacity", "0.8");
            svg.appendChild(path);
        }

        function drawDecoratedRect(svg, x, y, w, h, color, shape) {
            const gap = 25; 
            const drawPoint = (px, py) => {
                if (shape === 'circle') {
                    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    circle.setAttribute("cx", px + (Math.random()-0.5)*5);
                    circle.setAttribute("cy", py + (Math.random()-0.5)*5);
                    circle.setAttribute("r", 3 + Math.random()*2);
                    circle.setAttribute("fill", "none");
                    circle.setAttribute("stroke", color);
                    circle.setAttribute("stroke-width", 2);
                    svg.appendChild(circle);
                } else if (shape === 'cross') {
                    const cross = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    const cx = px + (Math.random()-0.5)*5;
                    const cy = py + (Math.random()-0.5)*5;
                    const s = 4;
                    cross.setAttribute("d", `M${cx-s},${cy-s} L${cx+s},${cy+s} M${cx+s},${cy-s} L${cx-s},${cy+s}`);
                    cross.setAttribute("stroke", color);
                    cross.setAttribute("stroke-width", 2);
                    cross.setAttribute("stroke-linecap", "round");
                    svg.appendChild(cross);
                }
            };
            for(let i=x; i<=x+w; i+=gap) { drawPoint(i, y); drawPoint(i, y+h); }
            for(let i=y; i<=y+h; i+=gap) { drawPoint(x, i); drawPoint(x+w, i); }
        }

        function generateWobblyRect(x, y, w, h) {
            const wiggle = () => (Math.random() - 0.5) * 10;
            return `M ${x+wiggle()} ${y+wiggle()} L ${x+w+wiggle()} ${y+wiggle()} L ${x+w+wiggle()} ${y+h+wiggle()} L ${x+wiggle()} ${y+h+wiggle()} Z`;
        }

        function drawSignature(container) {
            const group = document.createElement('div');
            group.className = 'signature-group';
            const name = maidNames[Math.floor(Math.random() * maidNames.length)];
            const today = new Date();
            const dateStr = `${today.getFullYear()}.${today.getMonth()+1}.${today.getDate()}`;
            group.innerHTML = `<div class="sig-name">${name} <span style="font-size:0.6em">â™¡</span></div><div class="sig-date">${dateStr}</div>`;
            group.querySelector('.sig-name').style.color = penColors[Math.floor(Math.random() * penColors.length)];

            container.appendChild(group);
            const w = 200; const h = 100; 
            const rot = (Math.random() - 0.5) * 15;
            group.style.transform = `rotate(${rot}deg)`;
            placeItem(group, w, h, container, true);
        }

        function drawText(container) {
            const text = jpTexts[Math.floor(Math.random() * jpTexts.length)];
            const el = document.createElement('div');
            el.className = 'text-item';
            el.innerText = text;
            el.style.color = palette[Math.floor(Math.random() * palette.length)];
            el.style.fontSize = `${24 + Math.random() * 20}px`;
            el.style.fontFamily = Math.random() > 0.5 ? "'RocknRoll One'" : "'Yomogi'";
            const rot = (Math.random() - 0.5) * 40;
            el.style.transform = `rotate(${rot}deg)`;
            container.appendChild(el);
            placeItem(el, text.length * 30, 40, container);
        }

        function placeItem(el, w, h, container, preferEdge = false) {
            const containerW = 340; const containerH = 540; const padding = 10;
            let found = false;
            for(let i=0; i<30; i++) {
                const left = Math.random() * (containerW - w - padding);
                const top = Math.random() * (containerH - h - padding);
                const newRect = { left, top, right: left + w, bottom: top + h };
                if (!checkCollision(newRect)) {
                    if (preferEdge && top > 120 && top < 380) { if (Math.random() > 0.1) continue; }
                    el.style.left = `${left}px`;
                    el.style.top = `${top}px`;
                    occupiedRects.push(newRect);
                    found = true;
                    break;
                }
            }
            if (!found) el.remove();
        }

        function checkCollision(r1) {
            const buffer = 5;
            for (let r2 of occupiedRects) {
                if (r1.left < r2.right + buffer && r1.right > r2.left - buffer && r1.top < r2.bottom + buffer && r1.bottom > r2.top - buffer) return true;
            }
            return false;
        }

        window.onload = generateArt;
    </script>
</body>
</html>
